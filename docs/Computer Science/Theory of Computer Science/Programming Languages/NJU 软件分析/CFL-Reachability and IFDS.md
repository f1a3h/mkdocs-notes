---
title: CFL-Reachability and IFDS
date: 2024-01-06T22:55:54+08:00
draft: false
math: true
description: CFL-Reachability and IFDS
categories:
  - Study Notes
  - Program Analysis
tags:
  - Program-Analysis
---
!!! info
	å—äº¬å¤§å­¦ã€Œ[è½¯ä»¶åˆ†æ](https://tai-e.pascal-lab.net/lectures.html)ã€è¯¾ç¨‹ CFL-Reachability and IFDS éƒ¨åˆ†çš„å­¦ä¹ ç¬”è®°ã€‚

## Feasible and Realizable Paths

infeasible paths æŒ‡çš„æ˜¯åœ¨ CFG å¹¶ä¸ä¼šå®é™…æ‰§è¡Œåˆ°çš„è·¯å¾„ï¼Œä¾‹å¦‚ if è¯­å¥ä¸­æŸäº›ä¸å¯èƒ½åˆ°è¾¾çš„åˆ†æ”¯ã€‚ç”±äº infeasible paths çš„åˆ¤å®šä¸ç¨‹åºçš„ semantics ç›¸å…³ï¼Œæ‰€ä»¥æ€»ä½“ä¸Šæ˜¯ undecidable çš„ã€‚

realizable paths æŒ‡çš„æ˜¯ â€œreturnsâ€ ä¸ â€œcallâ€ ç›¸å¯¹åº”çš„è·¯å¾„ï¼Œä¾‹å­å‚è€ƒ slidesã€‚realizable paths ä¸ä¸€å®šæ˜¯ executable çš„ (feasible paths)ï¼Œä½†æ˜¯ unrealizable paths ä¸€å®šä¸æ˜¯ executable çš„ (infeasible paths)ã€‚

## CFL-Reachability

ä½¿ç”¨ context sensitive çš„æŠ€æœ¯å¯ä»¥å»é™¤ unrealizable pathsï¼Œä½†æ˜¯è¿™é‡Œè¦ä»‹ç»çš„æŠ€æœ¯æ˜¯ CFL-Reachabilityã€‚

CFG-reachability: A path is considered to connect two nodes A and B, or B is reachable from A, only if the concatenation of the labels on the edges of the path is a word in a specified context-free language.ï¼ˆæ‡’å¾—ç¿»è¯‘æˆä¸­æ–‡äº†ï¼‰

CFG-reachability å…¶å®é‡‡ç”¨çš„å°±æ˜¯ä¸€ç§æ‹¬å·åŒ¹é…çš„æŠ€æœ¯æ¥åˆ¤æ–­ A åˆ° B çš„è·¯å¾„æ˜¯å¦åˆæ³•ï¼Œå¦‚æœåˆæ³•å°±è¯´ A åˆ° B æœ‰ä¸€æ¡è¾¹ï¼Œæœ‰ç‚¹è·¯å¾„å‹ç¼©çš„æ„Ÿè§‰ğŸ¤”ã€‚

- A valid sentence in language L must follow Lâ€™s grammar.ï¼ˆå³æ‹¬å·åŒ¹é…çš„è§„åˆ™ï¼šå·¦æ‹¬å·ä¸å³æ‹¬å·åŒ¹é…ï¼‰
- A context-free language is a language generated by a context-free grammar (CFG).

é€šè¿‡ CFL è§£å†³ partially balanced-parenthesis problemï¼š

- æ¯ä¸ªå³æ‹¬å· $)_i$ éœ€è¦ç›¸åº”çš„å·¦æ‹¬å· $(_i$ æ¥å¹³è¡¡ï¼Œä½†æ˜¯å·¦æ‹¬å·ä¸éœ€è¦ï¼Œå¦‚ä¸‹å›¾ä¸­ realizable çš„ç¬¬äºŒç§å¯èƒ½æ‰€ç¤º
- å¯¹äº call edge å’Œ return edgeï¼Œæˆ‘ä»¬ç”¨æ‰“ä¸Šæ ‡è®°çš„å·¦å³æ‹¬å·æ¥æ ‡è¯†
- å…¶ä»–çš„æ™®é€š edge ç”¨ $e$ æ ‡è¯†

realizable çš„å¯èƒ½å½¢å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œmatched è¡¨ç¤ºçš„æ˜¯ fully balanced-parenthesisï¼Œå¯èƒ½å½¢å¼å¦‚ä¸‹ï¼š

![CFL-Reachability](https://fastly.jsdelivr.net/gh/f1a3h/imgs/CFL-Reachability.png)


## Overview of IFDS

IFDS[^1] (Interprocedural, Finite, Distributive, Subset Problem) ä½¿ç”¨ distributive flow functions over finite domains æ¥è§£å†³ interprocedural dataflow analysisã€‚

[^1]: Thomas Reps, Susan Horwitz, and Mooly Sagiv, *"    Precise Interprocedural Dataflow Analysis via Graph Reachability"    *. POPL'95

### MRP

IFDS æä¾›äº†ä¸€ç§åä¸º meet-over all realizable paths (MRP) çš„æ–¹æ³•ï¼Œä¸å‰é¢çš„ MOP ç›¸ä¼¼ã€‚

> ä½†æ˜¯ CFG ä¸­æŸäº› path æ˜¯ not executable çš„ï¼Œä¹Ÿä¼šæœ‰ unboundedã€not enumerable çš„è·¯å¾„ï¼Œæ‰€ä»¥æ˜¾ç„¶ MOP æ˜¯ not fully preciseã€impractical çš„ã€‚[^2]

[^2]: [[Data Flow Analysis|NJUã€Œè½¯ä»¶åˆ†æã€å­¦ä¹ ç¬”è®°ï¼šData Flow Analysis]]

ç”±äº MRP é’ˆå¯¹çš„æ˜¯ realizable pathsï¼Œä¸€äº›æ²¡æœ‰å‡ºå£çš„å‡½æ•°éƒ½æ˜¾ç„¶ä¸ä¼šæ˜¯ realizable pathsï¼Œè¿™ä¿è¯äº† MRP æ˜¯å¯ä»¥ç»ˆæ­¢çš„ã€more precise than MOPã€practical çš„ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡º MRP $\subseteq$ MOPã€‚

$$
\mathrm{MRP_n}=\bigcup_{p\in\mathrm{RPaths}(start, n)}pf_p(\bot)
$$

### IFDS

ç»™å®šä¸€ä¸ª program P å’Œä¸€ä¸ª dataflow analysis problem Qï¼ŒIFDS è§£å†³æ­¥éª¤å¦‚ä¸‹ï¼š

- åŸºäº Q ç»™ P å»ºç«‹ä¸€ä¸ª supergraph G*ï¼Œç»™æ¯æ¡è¾¹å®šä¹‰ä¸€ä¸ª flow function
- å°† flow function è½¬æ¢ä¸ºå®ƒè¡¨ç¤ºçš„æ˜ å°„å…³ç³»å»ºç«‹ä¸€ä¸ª exploded supergraph G<sup>#</sup>
- æ­¤æ—¶ Q å·²ç»è¢«è½¬åŒ–ä¸º graph reachability problemï¼Œé€šè¿‡åœ¨ G<sup>#</sup> ä¸Šåº”ç”¨ tabulation algorithm æ¥è§£å†³
  - graph reachability problem: Let $n$ be a program point, data fact $d \in  \mathrm{MRP_n}$ , iff there is a realizable path in G<sup>#</sup> from $<s_{main}, 0>$ to $<n, d>$

## Supergraph and Flow Functions

### Supergraph

supergraph ä»¥ G* = (N*, E*) çš„å½¢å¼è¡¨ç¤ºï¼Œå®ƒç”±å¤šä¸ª flowgraph G ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ª G<sub>p</sub> éƒ½è¡¨ç¤ºäº†ä¸€ä¸ª procedureï¼Œåœ¨æ¯ä¸€ä¸ª G<sub>p</sub> ä¸­éƒ½æœ‰ä¸€ä¸ª start node $s_p$ å’Œ exit node $e_p$ï¼Œå¯¹äº procedure callï¼Œå®ƒä½¿ç”¨ä¸€ä¸ª call node $Call_p$ å’Œä¸€ä¸ª return-site node $Ret_p$ æ¥è¡¨ç¤º nodesï¼Œè¿˜ä½¿ç”¨äº† call-to-return-site edge (denoted by purple)ã€call-to-start edge (green)ã€exit-to-return-site edge (blue) è¡¨ç¤º edgesã€‚

![supergraph](https://fastly.jsdelivr.net/gh/f1a3h/imgs/supergraph.png)


### Design Flow Functions

ä»¥ Q = "    Possibly-uninitialized variables"    : for each node n âˆˆ N*, determine the set of variables that may be uninitialized before execution reaches n. ä¸ºä¾‹ã€‚

flow functions ä»¥ lambda è¡¨è¾¾å¼çš„å½¢å¼è¡¨ç¤ºï¼š$\lambda e_{param}.e_{body}$ã€‚

åœ¨ IFDS ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯æ¡è¾¹éƒ½è®¾è®¡ä¸€ä¸ª flow functionï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº global variable $g$ï¼Œåœ¨ call-to-return edge çš„ flow function ä¸­æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸º $\lambda S.S-\\{g\\}$ï¼š

- å¦‚æœ $g$ åœ¨å¦ä¸€ä¸ª procedure ä¸­è¢« initialize äº†ï¼Œé‚£ä¹ˆè¿™ä¹ˆåšæ˜¾ç„¶æ²¡é—®é¢˜
- å¦‚æœ $g$ æ²¡æœ‰è¢« initializeï¼Œé‚£ä¹ˆ call-to-return edge å’Œ exit-to-return edge çš„ facts åˆå¹¶åä¼šåŠ ä¸Š $g$

äºæ˜¯è¿™æ ·åšå¯ä»¥å‡å°‘ false positive ä»è€Œæé«˜ precisionã€‚

![design-flow-functions.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/design-flow-functions.png)


## Exploded Supergraph and Tabulation Algorithm

### Build Exploded Supergraph

åœ¨ exploded supergraph G<sup>#</sup> ä¸­ï¼ŒG* ä¸­çš„æ¯ä¸ª node éƒ½è¢«æ‹†åˆ†æˆ D+1 ä¸ª nodesï¼Œå¹¶ä¸” edge $n_1\to n_2$ ä¹Ÿä¼šè¢«æ‹†åˆ†ä¸ºè¿™æ¡è¾¹çš„ flow function çš„ representation relationï¼Œç±»ä¼¼äºä¸€ç§å‡½æ•°æ˜ å°„å…³ç³»ã€‚

![flowfunction.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/flow_function.png)


<details>

- default edge: $0\to 0$
- S è¡¨ç¤º statement
- D è¡¨ç¤ºçš„æ˜¯ flow function çš„ domain
- $\lambda S.S$ è¡¨ç¤º identity functionï¼Œå³è¾“å‡º = è¾“å…¥
</details>

å…³äºä¸ºä»€ä¹ˆè¦åŠ ä¸€ä¸ª 0 ç»“ç‚¹ï¼Œä¸ªäººç†è§£æ˜¯ä¸ºäº†å‡å°‘ç±»ä¼¼äº $\lambda S.\\\{a\\\}$ è¿™æ ·çš„æ’ç­‰å‡½æ•°éœ€è¦å¤šè¿å‡ºæ¥çš„å¾ˆå¤šè¾¹ï¼Œäºæ˜¯æä¸€ä¸ª default é€‰é¡¹ 0ï¼Œå°†è¿™ D æ¡è¾¹æ”¹æˆ $0\to a$ è¿™ä¸€æ¡è¾¹ä»è€Œå‡å°æ—¶ç©ºå¤æ‚åº¦ï¼Œè¿™æ ·ä¸€æ¥å°±æœ‰å¯èƒ½å‡ºç°å›¾ä¸è¿é€šçš„æƒ…å†µï¼Œä¸ºäº†ä¿è¯å›¾çš„è¿é€šæ€§æ‰€ä»¥æ¯æ¬¡å¿…é¡»åŠ ä¸€ä¸ª $0\to 0$ çš„è¾¹ã€‚

ä¸€ä¸ªå¯èƒ½çš„ exploded supergraph å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![explodedsupergraph.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/exploded_supergraph.png)


### Tabulation Algorithm

tabulation algorithm å¯ä»¥åœ¨ exploded supergraph G<sup>#</sup> ä¸Šé€šè¿‡æ‰¾å‡ºæ‰€æœ‰çš„ä» $<s_{main}, 0>$ å¼€å§‹çš„ realizable paths æ¥ç»™å‡º MRP solutionï¼Œæ—¶é—´å¤æ‚åº¦ $\mathcal{O}(ED^3)$ã€‚

![tabulation.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/tabulation_algo.png)


core working mechanism:

- åœ¨ $<Call_p, d_m>$ å’Œ $<Ret_p, d_n>$ ä¹‹é—´ä¼šæœ‰ä¸€æ¡ summary edge (denoted by pink)ï¼Œè¿™æ¡è¾¹ç”¨æ¥è¡¨æ˜ $d_n$ is reachable from $d_m$ï¼Œå½“æˆ‘ä»¬èµ° call-to-return edge æ—¶å°±å¯ä»¥è·³è¿‡ procedure $p$ ä¸­çš„ redundant work äº†
- å¤„ç† exit node ($e_{p^1}$) æ—¶ä¼šè¿›è¡Œ call-to-return matching: å…ˆæ‰¾å‡º call $p^1$ çš„ call sitesï¼Œå†æ ¹æ® call sites çš„ä¿¡æ¯æ‰¾å‡ºå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„ return sitesï¼Œè¿™ä¸€æ­¥ä¿è¯äº† IFDS æ˜¯ context sensitive çš„
- åœ¨æœ€å¼€å§‹ï¼Œæ‰€æœ‰è¡¨ç¤º data fact çš„ circle éƒ½æ˜¯ç™½è‰²çš„ï¼Œå½“ä¸€ä¸ª circle å˜ä¸ºè“è‰²çš„æ—¶å€™å°±è¡¨æ˜ $<n, d>$ is reachable from $<s_{main}, 0>$ï¼ˆç±»ä¼¼äºæŸ“è‰²æ³•ï¼‰

![coremechanism.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/core_mechanism.png)


## Understanding the Distributivity of IFDS

è€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼š

- IFDS å¯ä»¥è§£å†³ constant propagation å—ï¼Ÿ
  - constant propagation çš„ domain æ˜¯ infinite çš„ï¼Œè¿™ä¸ IFDS è¦æ±‚çš„ flow function çš„ domain åº”è¯¥æ˜¯ finite çš„çŸ›ç›¾ï¼Œå› æ­¤ä¸è¡Œ
- IFDS å¯ä»¥è§£å†³ pointer analysis å—ï¼Ÿ
  - ä¹Ÿä¸è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ IFDS çš„ distributivity æ¥è§£é‡Š

ç”¨ $f(x\land y)=f(x)\land f(y)$ å¯ä»¥æŠ½è±¡çš„è¡¨è¾¾ distributivity çš„å«ä¹‰ï¼Œæ„Ÿæ€§ç†è§£ä¸€ä¸‹å§ï¼ˆ

è§‚å¯Ÿ IFDS çš„ flow functionï¼Œå¯ä»¥å‘ç°å®ƒçš„è¾“å…¥ä¸è¾“å‡ºæ˜¯ $1\colon n$ çš„å…³ç³»ï¼Œè€Œ constant propagation çš„ flow function åˆ™æ˜¯ $n\colon 1$ çš„å…³ç³»ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚

ç°åœ¨æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç®€å•çš„ pointer analysisï¼Œå°è¯•ç”¨ IFDS æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚

![pointeranalysis.png](https://fastly.jsdelivr.net/gh/f1a3h/imgs/pointer_analysis_via_IFDS.png)


ä»å›¾ä¸­çš„çº¢è¾¹å¯ä»¥çœ‹å‡º IFDS ä¼šæ¼æ‰ alias informationï¼Œæƒ³è¦åŒ…å« alias information å°±å¿…ç„¶ä¼šè¦æœ‰ multiple inputsï¼Œè¿™ä¸ IFDS çš„ flow functions çš„è®¾è®¡æ˜¯ä¸ç¬¦åˆçš„ï¼Œæ‰€ä»¥ standard IFDS æ˜¯ä¸èƒ½è§£å†³ pointer analysis çš„ã€‚

ä¸€ä¸ªç®€å•çš„ rule æ¥åˆ¤æ–­ä¸€ä¸ªé—®é¢˜æ˜¯å¦èƒ½ç”¨ IFDSï¼šå¯¹äºä¸€ä¸ª statement $s$ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è€ƒè™‘ multiple input data facts æ¥å¾—åˆ°æ­£ç¡®çš„ output data factsï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±ä¸èƒ½é‡‡ç”¨ IFDSã€‚

å¦å¤–ï¼ŒIFDS è¿˜æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š

- æ— åæ•ˆæ€§ï¼šæ¯ä¸ª data fact (circle) å’Œå®ƒçš„ propagation (edges) éƒ½å¯ä»¥è¢«ç‹¬ç«‹è§£å†³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šä¸€ä¸ª circle æˆ–è€… edge çš„åˆ†æç»“æœä¸ä¼šå¯¹å½“å‰è¿™ä¸ª circle æˆ– edge çš„åˆ†æé€ æˆå½±å“
- å¦ä¸€ç§æ„ä¹‰ä¸Šçš„ã€Œå•å°„ã€ï¼šrepresentation relation çš„ rule ä¿è¯äº†æ¯ä¸ª output node æœ€å¤šåªä¼šè¢«ä¸€ä¸ª input node æŒ‡å‘